# CRG Makes
#
# @brief Common output definitions for Kibot
# @date 5/25/25
# @author cyberreefguru
# (c) CRG Makes 2025

kibot:
  version: 1

variants:
  - name: default
    comment: 'Just a place holder for the rotation filter'
    type: kibom
    variant: default
  - name: jlcpcb
    comment: 'JLCPCB requires some rotational transforms'
    type: kibom
    variant: jlcpcb
    # pre_transform: fix_rotation


groups:
  - name: jlc_fab
    comment: "Fabrication files without gerbers"
    outputs:
      - jlc_drill_file
      - jlc_pnp
      - jlc_bom
  - name: jlc_fab_2layer
    comment: "Fabrication files with 2 layer gerbers"
    outputs:
      - jlc_gerbers_2layer
      - jlc_fab
  - name: jlc_fab_4layer
    comment: "Fabrication files with 4 layer gerbers"
    outputs:
      - jlc_gerbers_4layer
      - jlc_fab
  - name: doc
    comment: "ibom, schematic, top and bottom images"
    outputs:
      - ibom
      - print_sch
      - board_top_image
      - board_bottom_image
  - name: 3d
    comment: "3d files"
    outputs:
      - step_file
  - name: render
    comment: "blender renders top, bottom, ortho"
    outputs:
      - render_top
      - render_bottom
      - render_ortho
  - name: non_fab
    comment: "All non-fabrication files -- doc, 3d, render"
    outputs:
      - doc
      - 3d
      - render
  - name: jlc_all4
    comment: "All 4 layer fabrication files -- fab_4layer, doc, 3d, render"
    outputs:
      - jlc_fab_4layer
      - non_fab
  - name: jlc_all2
    comment: "All 2 layer fabrication files -- fab_2layer, doc, 3d, render"
    outputs:
      - jlc_fab_2layer
      - non_fab

outputs:
  - name: compress_jlc_fab_2layer
    comment: "Generates a ZIP file with all the fab outputs"
    type: compress
    run_by_default: false
    options:
      files:
        - from_output: jlc_fab_2layer
  - name: compress_jlc_fab_4layer
    comment: "Generates a ZIP file with all the fab outputs"
    type: compress
    run_by_default: false
    options:
      files:
        - from_output: jlc_fab_4layer
  - name: compress_jlc_all_2layer
    comment: "Generates a ZIP file with all the fab outputs"
    type: compress
    run_by_default: false
    options:
      files:
        - from_output: jlc_all2
  - name: compress_jlc_all_4layer
    comment: "Generates a ZIP file with all the fab outputs"
    type: compress
    run_by_default: false
    options:
      files:
        - from_output: jlc_all4

  - name: 'jlc_gerbers_2layer'
    comment: "Generate JLC Gerbers for 2 layer board"
    run_by_default: false
    type: gerber
    dir: gerber
    options:
      exclude_edge_layer: true
      exclude_pads_from_silkscreen: false
      use_aux_axis_as_origin: false
      plot_sheet_reference: false
      plot_footprint_refs: true
      plot_footprint_values: true
      force_plot_invisible_refs_vals: false
      tent_vias: true
      line_width: 0.1
      subtract_mask_from_silk: false
      use_protel_extensions: false
      gerber_precision: 4.6
      create_gerber_job_file: true
      use_gerber_x2_attributes: false
      use_gerber_net_attributes: false
      output: '%f.%i'

    layers:
      - layer: F.Cu
        suffix: GTL
      - layer: B.Cu
        suffix: GBL
      - layer: F.SilkS
        suffix: GTO
      - layer: B.SilkS
        suffix: GBO
      - layer: F.Mask
        suffix: GTS
      - layer: B.Mask
        suffix: GBS
      - layer: Edge.Cuts
        suffix: GKO

  - name: 'jlc_gerbers_4layer'
    comment: "Generate JLC Gerbers for 4 layer board"
    run_by_default: false
    type: gerber
    dir: gerber
    options:
      exclude_edge_layer: true
      exclude_pads_from_silkscreen: false
      use_aux_axis_as_origin: false
      plot_sheet_reference: false
      plot_footprint_refs: true
      plot_footprint_values: true
      force_plot_invisible_refs_vals: false
      tent_vias: true
      line_width: 0.1
      subtract_mask_from_silk: false
      use_protel_extensions: false
      gerber_precision: 4.6
      create_gerber_job_file: true
      use_gerber_x2_attributes: false
      use_gerber_net_attributes: false
      output: '%f.%i'

    layers:
      - layer: F.Cu
        suffix: GTL
      - layer: In1.Cu
        suffix: G2L
      - layer: In2.Cu
        suffix: G3L
      - layer: B.Cu
        suffix: GBL
      - layer: F.SilkS
        suffix: GTO
      - layer: B.SilkS
        suffix: GBO
      - layer: F.Mask
        suffix: GTS
      - layer: B.Mask
        suffix: GBS
      - layer: Edge.Cuts
        suffix: GKO

  - name: 'jlc_drill_file'
    comment: 'Generate JLC Drill File'
    run_by_default: false
    type: excellon
    dir: gerber
    options:
      metric_units: false
      pth_and_npth_single_file: true

  - name: 'jlc_pnp'
    comment: 'Generate JLC PnP File'
    run_by_default: false
    type: position
    dir: pnp
    options:
      output: '%f-jlc-cpl.%x'
      format: CSV
      units: millimeters
      separate_files_for_front_and_back: false
      only_smd: false
      variant: jlcpcb
      columns:
        - id: Ref
          name: Designator
        - id: PosX
          name: "Mid X"
        - id: PosY
          name: "Mid Y"
        - id: Side
          name: Layer
        - id: Rot
          name: Rotation

  - name: 'jlc_bom'
    comment: "BOM for JLC"
    run_by_default: false
    type: bom
    dir: pnp
    options:
      output: '%f-jlc-bom.%x'
      ref_separator: ','
      columns:
        - field: Value
          name: Comment
        - field: References
          name: Designator
        - field: Footprint
          name: Footprint
        - field: LCSC
          name: 'LCSC'
      csv:
        hide_pcb_info: true
        hide_stats_info: true
        quote_all: true

  - name: 'ibom'
    comment: "Generate Interactive BOM"
    run_by_default: false
    type: ibom
    dir: doc/ibom
    options:
      output: '%f-ibom.%x'
      show_fields: 'Value,Description,MN,MPN,Footprint'
      extra_fields: 'Description,MN,MPN'
      dark_mode: true
      name_format: "index"
      forced_name: "Aquarius Power Module"

  - name: 'print_sch'
    comment: "Print schematic (PDF)"
    run_by_default: false
    type: pdf_sch_print
    dir: doc/schematic
    options:
      output: '%f-schematic.%x'

  - name: 'board_top_image'
    comment: "Top View PNG"
    run_by_default: false
    type: pcbdraw
    dir: doc/image
    options:
      output: '%f-pcb-top.%x'
      format: png
      margin: 5
      show_solderpaste: false
      show_components: all
      warnings: visible

  - name: 'board_bottom_image'
    comment: "Bottom View PNG"
    run_by_default: false
    type: pcbdraw
    dir: doc/image
    options:
      bottom: true
      output: '%f-pcb-bottom.%x'
      format: png
      margin: 5
      show_solderpaste: false
      show_components: all
      warnings: visible

  - name: 'step_file'
    comment: 'Generate STEP file'
    run_by_default: false
    type: export_3d
    dir: doc/3d
    options:
      output: '%f.%x'
      download: false
      download_lcsc: false
      include_pads: true
      include_silkscreen: true
      include_soldermask: true
      subst_models: true
      cut_vias_in_body: true

  - name: 'render_top'
    comment: "3D render top"
    run_by_default: false
    type: blender_export
    dir: doc/render
    options:
      outputs:
        output: '%f-render-top.%x'
      render_options:
        samples: 10
      point_of_view:
        view: "top"

  - name: 'render_bottom'
    comment: "3D render bottom"
    run_by_default: false
    type: blender_export
    dir: doc/render
    options:
      outputs:
        output: '%f-render-bottom.%x'
      render_options:
        samples: 10
      point_of_view:
        view: "bottom"

  - name: 'render_ortho'
    comment: "3D render at 30 degrees"
    run_by_default: false
    type: blender_export
    dir: doc/render
    options:
      outputs:
        output: '%f-render-ortho.%x'
      render_options:
        samples: 10
      point_of_view:
        rotate_x: 30
        rotate_z: -20